- render :partial => 'islay/admin/reports/nav'
- sub_header('Shop Overview')

= content(:class => 'inset') do

  = column(8) do
    %div#order-graphs.report-cell
      %h3 Orders Over Time

      %table.series-graph
        %thead
          %tr
            %th Day
            %th Order Value
            %th Order Volume
            %th SKU Volume

        %tbody
          - @series.each do |entry|
            %tr
              %th= entry['day']
              %td= entry['value']
              %td= entry['volume']
              %td= entry['sku_volume']

    %div#top-ten.report-cell
      %h3 SKU Top Ten

      %table#skus-by-revenue
        %caption Revenue

        %thead
          %tr
            %th.rank Rank
            %th SKU
            %th Revenue
            %th.movement Movement

        %tbody
          - @top_ten[:revenue].each do |entry|
            %tr
              %td.rank= entry['position']
              %td
                = link_to(entry.long_desc, path(:product, :id => entry['product_id']))
              %td= format_money(entry['revenue'])
              %td.movement
                %span(class="move-#{entry['dir']}")= entry['dir'].humanize
                %span.amount= entry['shift']

      %table#skus-by-volume
        %caption Volume

        %thead
          %tr
            %th.rank Rank
            %th SKU
            %th Volume
            %th.movement Movement

        %tbody
          - @top_ten[:volume].each do |entry|
            %tr
              %td.rank= entry['position']
              %td
                = link_to(entry.long_desc, path(:product, :id => entry['product_id']))
              %td= entry['volume']
              %td.movement
                %span(class="move-#{entry['dir']}")= entry['dir'].humanize
                %span.amount= entry['shift']

  = column(4) do
    %div#detailed-nav.report-cell
      %h3 Detailed Reports:
      %ul
        %li= link_to('Orders', path(:order_reports))
        %li= link_to('Products', path(:product_reports))

    %div.report-cell.total
      %h3 Order Volume
      = @totals.total('volume', false)
      = @totals.movement('volume', false)
      = @totals.average('volume', false)
      = @totals.best('volume', false)

    %div.report-cell.total
      %h3 Revenue
      = @totals.total('revenue')
      = @totals.movement('revenue')
      = @totals.average('revenue')
      = @totals.best('revenue')

    %div.report-cell.total
      %h3 Average Order Value
      = @totals.total('average_value')
      = @totals.movement('average_value')
      = @totals.average('average_value')
      = @totals.best('average_value')

    %div.report-cell.total
      %h3 Total Orders
      %p.total= @totals['total_volume']
      %p.since Since: #{format_month(@totals['first_order'])}

    %div.report-cell.total
      %h3 Total Revenue
      %p.total= format_money(@totals['total_revenue'])
      %p.since Since: #{format_month(@totals['first_order'])}

